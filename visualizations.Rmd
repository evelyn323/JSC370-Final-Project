---
title: "Visualizations"
output: 
    html_document:
        toc: TRUE
        toc_float: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  eval=TRUE,
  echo = FALSE,
  cache = TRUE,
  cache.lazy = FALSE)
library(ggplot2)
library(tidyverse)
library(plotly)
```

```{r source bike data}
# Run all lines of the code in process_COVID_data.R
source("ReadBikeData.R")
```

## Temperature Variables

### Figure 1


```{r figure 1}
# plot the rental count against max, mean, and minimum temperature
plot1 <- df %>% ggplot() +
  geom_line(aes(x = Max_temp, y = Rental_count, color = "Max Temperature")) +
  geom_line(aes(x = Mean_temp, y = Rental_count, color = "Mean Temperature")) +
  geom_line(aes(x = Min_temp, y = Rental_count, color = "Min Temperature")) +
  labs(x = "Temperature (°C)", y = "Rental Count", color = "Legend")

ggplotly(plot1)
```

From Figure 1, we notice that the relationship between the rental count and the temperature is the same no matter if we use maximum, mean, and minimum temperature. Thus for all subsequent analysis, only the mean temperature will be used, as it provides the same amount of useful information as the other temperature variables.

## Day of Week Associations {.tabset}

In the plots below, we will examine whether the relationship between daily bike rental counts in Toronto and other weather variables is influenced by the day of the week. 

### Figure 2

```{r figure 2}
# plot the rental count against mean temp for each weekday
plot2 <- df %>% ggplot(aes(x = Mean_temp, y = Rental_count, color = Weekday)) +
  labs(x = "Mean Temperature (°C)" ,y = "Rental Count") +
  geom_line()

ggplotly(plot2)
```

### Figure 3

```{r figure 3}
# plot the rental count against precipitation for each weekday
plot3 <- df %>% ggplot(aes(x = Precipitation, y = Rental_count, color = Weekday)) +
  labs(x = "Precipitation (mm)" ,y = "Rental Count") +
  geom_line()

ggplotly(plot3)
```

### Figure 4
```{r figure 4}
# plot the rental count against precipitation for each weekday
plot4 <- df %>% ggplot(aes(x = Snow, y = Rental_count, color = Weekday)) +
  labs(x = "Snow (cm)" ,y = "Rental Count") +
  geom_line()

ggplotly(plot4)
```


## {-}

From the Figure 3 and 4 above, we can observe that the day of the week doesn't seem to change the relationship between precipitation and bike ridership and snow and bike ridership. On the other hand, in Figure 2, there does appear to be a slight tendency toward more bike share ridership on weekends verus weekdays. 

## Effect of Weather Interactions {.tabset}

Now we will explore whether interactions between weather variables affects (e.g. will rain on a warm or cold day be more likely to affect rental count)

```{r figure 5}
plot5 <- df %>% 
  plot_ly(x = ~Mean_temp, 
          y = ~Rental_count,
          type = 'scatter', 
          mode = 'markers', 
          color = ~Weekday,
          size = ~Precipitation, 
          sizes = c(5, 70), 
          fill = ~'', 
          marker = list(sizemode='diameter', opacity=0.5),
          hoverinfo = 'text',
          text = ~paste( paste(Date, ":", sep=""), 
                         paste(" Precipitation (mm): ", Precipitation, sep="") , 
                         paste(" Mean Temperature (°C): ", Mean_temp, sep=""), sep = "<br>")) %>%
  layout(title = "Rental count vs Mean Temperature (°C)",
         yaxis = list(title = "Rental Count"), 
         xaxis = list(title = "Mean Temperature (°C)"),
         hovermode = "compare")
```

```{r show figure 5}
plot5
```

In Figure 5, notice that when temperature is held constant, the precipitation does decrease rental count, however having a higher mean temperature means that even if there is precipitation, the rental count is still higher than with a significantly lower mean temperature and no precipitation.